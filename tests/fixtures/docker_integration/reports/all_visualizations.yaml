id: all_visualizations
title: All Visualization Types Test
description: Test report showcasing all available visualization types
template: report.html.j2

components:
  # 1. Simple table - default columns
  - id: simple_table
    title: Simple Table - All Sales
    provider: postgres_test
    query:
      text: |
        SELECT 
          region,
          product,
          revenue,
          units_sold,
          sale_date
        FROM sales_metrics
        ORDER BY sale_date DESC, revenue DESC
        LIMIT 10
    render:
      type: table

  # 2. Aggregated table with numeric formatting
  - id: aggregated_table
    title: Aggregated Sales by Region
    provider: postgres_test
    query:
      text: |
        SELECT 
          region,
          COUNT(*) as transaction_count,
          SUM(revenue) as total_revenue,
          SUM(units_sold) as total_units,
          ROUND(AVG(revenue), 2) as avg_revenue,
          MIN(sale_date) as first_sale,
          MAX(sale_date) as last_sale
        FROM sales_metrics
        GROUP BY region
        ORDER BY total_revenue DESC
    render:
      type: table

  # 3. Customer feedback with text data
  - id: feedback_table
    title: Customer Feedback
    provider: postgres_test
    query:
      text: |
        SELECT 
          customer_name,
          product,
          rating,
          comment,
          feedback_date
        FROM customer_feedback
        ORDER BY rating DESC, feedback_date DESC
    render:
      type: table

  # 4. Text renderer - single value with formatting
  - id: total_revenue_text
    title: Total Revenue
    provider: postgres_test
    query:
      text: |
        SELECT CAST(SUM(revenue) AS FLOAT) as total_revenue
        FROM sales_metrics
    render:
      type: text
      options:
        template: "Total Revenue: {value:,.2f}"
        value_path: total_revenue

  # 5. Text renderer - count
  - id: transaction_count
    title: Transaction Count
    provider: postgres_test
    query:
      text: |
        SELECT CAST(COUNT(*) AS INTEGER) as count
        FROM sales_metrics
    render:
      type: text
      options:
        template: "Total Transactions: {value}"
        value_path: count

  # 6. System health status
  - id: health_status
    title: System Health
    provider: postgres_test
    query:
      text: |
        SELECT 
          service_name,
          status,
          response_time_ms,
          error_count,
          check_timestamp
        FROM system_health
        ORDER BY 
          CASE status 
            WHEN 'healthy' THEN 1
            WHEN 'degraded' THEN 2
            ELSE 3
          END,
          service_name
    render:
      type: table

  # 7. Top products
  - id: top_products
    title: Top 5 Products by Revenue
    provider: postgres_test
    query:
      text: |
        SELECT 
          product,
          SUM(revenue) as total_revenue,
          SUM(units_sold) as total_units,
          COUNT(*) as transactions
        FROM sales_metrics
        GROUP BY product
        ORDER BY total_revenue DESC
        LIMIT 5
    render:
      type: table

  # 8. Average ratings
  - id: average_ratings
    title: Product Ratings
    provider: postgres_test
    query:
      text: |
        SELECT 
          product,
          COUNT(*) as review_count,
          ROUND(AVG(rating), 2) as avg_rating,
          MIN(rating) as min_rating,
          MAX(rating) as max_rating
        FROM customer_feedback
        GROUP BY product
        ORDER BY avg_rating DESC
    render:
      type: table

  # 9. Recent transactions
  - id: recent_transactions
    title: Last 5 Transactions
    provider: postgres_test
    query:
      text: |
        SELECT 
          sale_date,
          region,
          product,
          revenue,
          units_sold,
          ROUND(revenue / units_sold, 2) as price_per_unit
        FROM sales_metrics
        ORDER BY sale_date DESC, id DESC
        LIMIT 5
    render:
      type: table

  # 10. Average rating
  - id: average_rating
    title: Overall Average Rating
    provider: postgres_test
    query:
      text: |
        SELECT CAST(ROUND(AVG(rating::NUMERIC), 2) AS FLOAT) as avg_rating
        FROM customer_feedback
    render:
      type: text
      options:
        template: "Average Customer Rating: {value} out of 5 stars"
        value_path: avg_rating

  # 11. HTML card - Key metrics
  - id: key_metrics_card
    title: Key Performance Indicators
    provider: postgres_test
    query:
      text: |
        SELECT 
          COUNT(*) as total_transactions,
          CAST(SUM(revenue) AS FLOAT) as total_revenue,
          CAST(AVG(revenue) AS FLOAT) as avg_transaction,
          CAST(MAX(revenue) AS FLOAT) as max_transaction
        FROM sales_metrics
    render:
      type: html
      options:
        template: |
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
              <div style="font-size: 32px; font-weight: bold;">{{ total_transactions }}</div>
              <div style="font-size: 14px; opacity: 0.9;">Total Transactions</div>
            </div>
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
              <div style="font-size: 32px; font-weight: bold;">{{ "{:,.0f}".format(total_revenue) }}</div>
              <div style="font-size: 14px; opacity: 0.9;">Total Revenue</div>
            </div>
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
              <div style="font-size: 32px; font-weight: bold;">{{ "{:,.0f}".format(avg_transaction) }}</div>
              <div style="font-size: 14px; opacity: 0.9;">Avg Transaction</div>
            </div>
            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 8px; text-align: center;">
              <div style="font-size: 32px; font-weight: bold;">{{ "{:,.0f}".format(max_transaction) }}</div>
              <div style="font-size: 14px; opacity: 0.9;">Max Transaction</div>
            </div>
          </div>

  # 12. HTML list - Top regions
  - id: top_regions_list
    title: Top Performing Regions
    provider: postgres_test
    query:
      text: |
        SELECT 
          region,
          CAST(SUM(revenue) AS FLOAT) as total_revenue,
          COUNT(*) as transactions
        FROM sales_metrics
        GROUP BY region
        ORDER BY total_revenue DESC
        LIMIT 3
    render:
      type: html
      options:
        template: |
          <div style="font-family: Arial, sans-serif;">
            {% for row in data %}
            <div style="display: flex; align-items: center; padding: 12px; margin-bottom: 8px; background: {% if loop.index == 1 %}#ffd700{% elif loop.index == 2 %}#c0c0c0{% else %}#cd7f32{% endif %}20; border-left: 4px solid {% if loop.index == 1 %}#ffd700{% elif loop.index == 2 %}#c0c0c0{% else %}#cd7f32{% endif %}; border-radius: 4px;">
              <div style="font-size: 24px; font-weight: bold; width: 40px; color: {% if loop.index == 1 %}#ffd700{% elif loop.index == 2 %}#c0c0c0{% else %}#cd7f32{% endif %};">#{{ loop.index }}</div>
              <div style="flex: 1;">
                <div style="font-weight: bold; font-size: 16px;">{{ row.region }}</div>
                <div style="color: #666; font-size: 14px;">{{ row.transactions }} transactions • {{ "{:,.2f}".format(row.total_revenue) }}</div>
              </div>
            </div>
            {% endfor %}
          </div>

  # 13. Progress bar - Rating distribution
  - id: rating_distribution
    title: Customer Rating Distribution
    provider: postgres_test
    query:
      text: |
        SELECT 
          rating,
          COUNT(*) as count,
          CAST(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER () AS FLOAT) as percentage
        FROM customer_feedback
        GROUP BY rating
        ORDER BY rating DESC
    render:
      type: html
      options:
        template: |
          <div style="font-family: Arial, sans-serif;">
            {% for row in data %}
            <div style="margin-bottom: 12px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                <span style="font-weight: 500;">{{ row.rating }} stars</span>
                <span style="color: #666;">{{ row.count }} reviews ({{ "{:.1f}".format(row.percentage) }}%)</span>
              </div>
              <div style="background: #e0e0e0; height: 24px; border-radius: 12px; overflow: hidden;">
                <div style="background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%); height: 100%; width: {{ row.percentage }}%; transition: width 0.3s;"></div>
              </div>
            </div>
            {% endfor %}
          </div>

  # 14. Badge list - Product status
  - id: product_badges
    title: Product Performance Badges
    provider: postgres_test
    query:
      text: |
        SELECT 
          product,
          CAST(SUM(revenue) AS FLOAT) as revenue,
          COUNT(*) as sales_count,
          CASE 
            WHEN SUM(revenue) > 90000 THEN 'Top Seller'
            WHEN SUM(revenue) > 50000 THEN 'Best Seller'
            ELSE 'Regular'
          END as badge
        FROM sales_metrics
        GROUP BY product
        ORDER BY revenue DESC
    render:
      type: html
      options:
        template: |
          <div style="display: flex; flex-wrap: wrap; gap: 12px;">
            {% for row in data %}
            <div style="flex: 1; min-width: 200px; padding: 16px; border: 2px solid {% if row.badge == 'Top Seller' %}#ef4444{% elif row.badge == 'Best Seller' %}#f59e0b{% else %}#94a3b8{% endif %}; border-radius: 8px; background: white;">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: bold; font-size: 16px;">{{ row.product }}</span>
                <span style="background: {% if row.badge == 'Top Seller' %}#ef4444{% elif row.badge == 'Best Seller' %}#f59e0b{% else %}#94a3b8{% endif %}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">{{ row.badge }}</span>
              </div>
              <div style="color: #666; font-size: 14px;">{{ "{:,.2f}".format(row.revenue) }}</div>
              <div style="color: #94a3b8; font-size: 12px;">{{ row.sales_count }} sales</div>
            </div>
            {% endfor %}
          </div>

  # 15. Alert box - System health summary
  - id: health_alert
    title: System Health Alert
    provider: postgres_test
    query:
      text: |
        SELECT 
          COUNT(*) as total_services,
          COUNT(CASE WHEN status = 'healthy' THEN 1 END) as healthy_count,
          COUNT(CASE WHEN status = 'degraded' THEN 1 END) as degraded_count,
          COUNT(CASE WHEN status NOT IN ('healthy', 'degraded') THEN 1 END) as down_count
        FROM system_health
    render:
      type: html
      options:
        template: |
          <div style="font-family: Arial, sans-serif;">
            {% set health_pct = (data[0].healthy_count / data[0].total_services * 100)|round %}
            {% if data[0].down_count > 0 %}
            <div style="background: #fee2e2; border-left: 4px solid #dc2626; padding: 16px; border-radius: 4px;">
              <div style="display: flex; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 20px; margin-right: 8px;">⚠️</span>
                <span style="font-weight: bold; color: #dc2626;">Critical: Services Down</span>
              </div>
              <p style="margin: 0; color: #991b1b;">{{ data[0].down_count }} service(s) are currently down. Immediate attention required.</p>
            </div>
            {% elif data[0].degraded_count > 0 %}
            <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 4px;">
              <div style="display: flex; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 20px; margin-right: 8px;">⚡</span>
                <span style="font-weight: bold; color: #d97706;">Warning: Degraded Performance</span>
              </div>
              <p style="margin: 0; color: #92400e;">{{ data[0].degraded_count }} service(s) experiencing degraded performance. {{ data[0].healthy_count }} services healthy.</p>
            </div>
            {% else %}
            <div style="background: #d1fae5; border-left: 4px solid #10b981; padding: 16px; border-radius: 4px;">
              <div style="display: flex; align-items: center; margin-bottom: 8px;">
                <span style="font-size: 20px; margin-right: 8px;">✅</span>
                <span style="font-weight: bold; color: #059669;">All Systems Operational</span>
              </div>
              <p style="margin: 0; color: #065f46;">All {{ data[0].total_services }} services are running smoothly. System health: {{ health_pct }}%</p>
            </div>
            {% endif %}
          </div>

email:
  to:
    - test@queryhub.local
  subject: "[Test] All Visualization Types"
